#   Elaya,; the compiler for the ;elaya language
#    Copyright (C) 1999,2001  J.v.Iddekinge.
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

# Directories where compiled files go, change is as you wish

function help()
{
	echo "configure options:"
	echo "-p <host>   where host is win32 or linux"
	echo "-t <target> where target is win32 or linux"
	echo "-a <aspath> path to as assembler (including name of as)"
	echo "-h          this help info"
	exit
}


echo "config started" >config.log

if test $HOME = "/"; then HOME=`pwd`;fi;
vlHost=""
case $OSTYPE in
	"linux-gnu" ) vlHost="linux";;
	"cygwin" ) vlHost="win32";;
esac
vlTarget=$vlHost
vlAsPath=""  

while getopts ":hp:t:a:" vlOption
do
	case $vlOption in
	p ) $vlHost=$OPTARG;;
	t ) $vlTarget=$OPTARG;;
	a ) $vlAsPath=$OPTARG;;
	* ) echo " Unsupported option";exit;;
esac
done
if(test $vlHost = ""); then
	echo "Host platform unkown, use -h option to set host platform";
fi
echo "Host platform = $vlHost"
echo "Target        = $vlTarget"
echo "Assembler path= $vlAsPath"

cd build_files/programs
sh conf.$vlHost $vlTarget
cd ../..
source config/config_conf.$vlHost.$vlTarget
source build_files/config/param.$vlHost.$vlTarget


Dir_Program=$HOME/bin/elaya/bin
Dir_Cpl_Lib=$HOME/bin/lib
Dir_Ela_Rtl=$HOME/bin/elaya/lib

#set to y when compiling win32 and linux under linux.
#compile linux under win32 supported, but the
#build system can't handle it.
Can_Cross_Compile='y'
#fpc and ela options

Fpc="ppc386"
ela="$Dir_Program/ela"
eladep="$Dir_Program/eladep"

Opt_Fpc="-dmalloc -a -O2g -CR  -Ci- -gl -Ch1000000  -S2c  -vrwen -Ratt"
Fpc_Opt_Unit_Path="/home/jeroen/fpc/"


# Main Program1

build_conf_gen="config/build_conf.gen"

echo "os_host=$vlHost" >>$build_conf_gen

build_conf="config/build_conf.$vlHost.$vlTarget"

echo Fpc_Opt_Unit_Path=$Fpc_Opt_Unit_Path>$build_conf
echo Dir_Cpl_Lib=$Dir_Cpl_Lib>>$build_conf
echo Dir_Program=$Dir_Program>>$build_conf
echo Dir_Rtl=$Dir_Ela_Rtl/$vlTarget>>$build_conf
echo Dir_Ela_Rtl_Base=$Dir_Ela_Rtl>>$build_conf
echo Os_Host=$vlHost>>$build_conf
echo Os_Target=$vlTarget>>$build_conf
echo Opt_Fpc=$Opt_Fpc>>$build_conf
echo Fpc=$Fpc>>$build_conf
echo ELA=$ela>>$build_conf
echo Opt_Ela=$Opt_Ela>>$build_conf
echo Rtl_Target=$Rtl_Target>>$build_conf
echo Can_Cross_Compile=$Can_Cross_Compile>>$build_conf
echo Cpl_Target=$vlHost>>$build_conf
echo cmd_rm=$cmd_rm>>$build_conf
echo cmd_cp=$cmd_cp>>$build_conf
echo Dir_Dirt=./bin>>$build_conf
echo Dir_Sep=/>>$build_conf
echo Dir_as=$conf_as_path>>$build_conf
echo Dir_ld=$conf_ld_path>>$build_conf
echo auto_load=$_auto_load>>$build_conf
echo pp_unit_ext=$pp_unit_ext>>$build_conf
echo eladep=$eladep>>$build_conf
echo exe_ext=$exe_ext>>$build_conf


mkdir -p $Dir_Program
mkdir -p $Dir_Cpl_Lib
mkdir -p $Dir_Ela_Rtl
mkdir -p $Dir_Ela_Rtl/$vlTarget
mkdir -p dirt

sh build_files/programs/mkelamake.sh <build_files/config/eladirs.db >>config.log


echo
echo FEEDBACK FEEDBACK FEEDBACK
echo 
echo For problems, bugs and comments please visit www.elaya.org.
echo or mailing list at : Elaya-public@lists.Sourceforge.net
echo 
echo Thank you
echo 

